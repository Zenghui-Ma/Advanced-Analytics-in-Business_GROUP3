{"aid": "40158539", "title": "Extracting all domains registered in a Cloudflare account", "url": "https://celes.in/posts/cloudflare_ns_whois", "domain": "celes.in", "votes": 1, "user": "celesian", "posted_at": "2024-04-25 15:14:03", "comments": 0, "source_title": "Celesian's blog | /posts/cloudflare_ns_whois", "source_text": "Celesian's blog | /posts/cloudflare_ns_whois\n\n# celes.in\n\n### \\\\\\celes.in\\C$\\inetpub\\wwwroot\\blog\\posts\\cloudflare_ns_whois\n\n## [quick tip] dumping all domains from a CloudFlare account\n\nCloudflare is a widely-utilized Content Delivery Network (CDN) provider,\noffering an array of services like DDoS mitigation and DNS management. Its\nclientele spans numerous industries, including several Fortune 500 companies.\n\nsometimes, you may want to enumerate all the domains that are associated with\na CloudFlare account. This can be useful for bug bounty hunters who want to\nfind other domains that are owned by the same company.\n\nthere are existing methods to do this, but they have some limitations. for\nexample, you can use the crt.sh website to search for certificates that are\nassociated with a domain. However, this method is not very reliable because it\nyou rely on the domain being present in the certificate's Subject Alternative\nName (SAN) field. This is not always the case, so you may miss some domains.\n\nanother method is to use an Reverse WHOIS lookup service like WhoisXML API to\nsearch a company's registered email address, name or address. This method is\nmore reliable, but sometimes the registrar of the company's domain might have\nwhois privacy protection features which make this attack unfeasible, since\nneither you or the API will be able to see the registrant's information.\n\n### Enumerating all domains from a CloudFlare account by nameserver\ncorrelation\n\naccording to CloudFlare's blog, each cloudflare account has a pair of\nnameservers assigned to it. since this nameserver combination contains a fair\namount of entropy, it is unlikely that too much accounts will have the same\npair of nameservers. therefore, we can use this information to enumerate all\nthe domains that are associated with a CloudFlare account.\n\nwe are lucky, because nameservers are listed on the WHOIS records of a domain.\nthis means that we can use a reverse WHOIS service to search for domains that\nhave the same pair of nameservers.\n\nin this blog post, we will be using WhoisXMLAPI to perform the reverse WHOIS\nlookup. you can use other services if you want, but the steps may be\ndifferent.\n\nfirst, we need to find the nameservers of the target domain. we can do this by\ndoing a simple dig query on the target domain. extracting the nameservers of\nDiscord as an example would look like this:\n\n$ dig NS discord.com +short gabe.ns.cloudflare.com. sima.ns.cloudflare.com.\n\nnow that we have the nameservers, we can use the WhoisXMLAPI to search for\ndomains that have the same pair of nameservers. the API has a free tier that\nallows you to perform 500 queries per month, which should be enough for most\nuse cases.\n\nwe can do that by issuing the following request:\n\ncurl https://reverse-whois.whoisxmlapi.com/api/v2 --data\n'{\"apiKey\":\"<APIKEY>\",\"searchType\":\"current\",\"mode\":\"purchase\",\"advancedSearchTerms\":[{\"field\":\"NameServers\",\"term\":\"gabe.ns.cloudflare.com\"},{\"field\":\"NameServers\",\"term\":\"sima.ns.cloudflare.com.\"}]}'\n-o whois.json\n\nExecuting this query yielded a large list of 742 potential domains. To narrow\ndown this list to domains affirmatively associated with Discord, one might\nperform a manual review. However, for brevity's sake, we'll apply a quick\nfilter using grep for the term \"Discord\" within the results:\n\nuser ) cat whois.json | jq .domainsList[] -r | grep -i discord discordapp.com discord.media discord.gifts discord-activities.com discord.co discord.tools discord.new discord.gg discordrtc.com discordapp.io discord.store discord.gift discord.com discordapp.net discord.ws discord.dev discord.design discord.help discordmerch.com discordsound.com discordcdn.com discordgames.com discordsays.com\n\nThe outcome is astonishing; a simple search reveals numerous domains, and\nfurther investigation will likely confirm that the majority are indeed managed\nby Discord.\n\n### finishing it off\n\nThis technique highlights how a little of investigation can go a long way.\nIt's important to note that this method is not foolproof, and it may not work\nin all cases. However, it's one of many great ways to find domains associated\nwith a company.\n\nGive this method a try, and you might just be surprised at what you find. It's\nall about being curious. Now go see what you can uncover. Good luck out there!\n\n", "frontpage": false}
